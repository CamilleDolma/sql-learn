非常好！既然你已经掌握了 Hive SQL 的基础知识，我们可以进一步挑战一些 **高级应用题目**，这些题目更贴近真实的数据挖掘场景，涉及复杂查询、性能优化、数据建模、ETL、以及与数据分析相关的技巧。

---

## 🧠 高级 Hive SQL 应用题集（共 6 个模块）

---

### **模块一：复杂窗口函数与排名分析**

1. **连续增长工资的员工识别**  
   查询工资连续三个月增长的员工（假设有 `monthly_salary` 表，包含 `employee_id`, `month`, `salary`）。

2. **员工在部门内的工资百分位排名**  
   使用窗口函数计算每位员工在其部门内的工资百分位。

3. **员工入职时间排名与工资对比**  
   查询每个部门中最早入职的员工与最新入职员工的工资差异。

---

### **模块二：多层嵌套查询与复杂逻辑**

4. **找出每个部门中工资高于部门平均工资的员工**  
   使用嵌套子查询实现。

5. **查询工资排名前 10% 的员工**  
   使用窗口函数或子查询结合 `NTILE`。

6. **找出连续两个月工资下降的员工**  
   使用 `LAG` 函数结合时间排序。

---

### **模块三：数据质量检查与异常检测**

7. **检测重复记录**  
   查询 `employees` 表中重复的 `name` 和 `join_date`。

8. **识别工资异常值（如高于 3 倍中位数）**  
   使用中位数计算和筛选异常。

9. **识别部门中员工数量异常的情况（如人数 < 2 或 > 100）**

---

### **模块四：ETL 与数据转换逻辑**

10. **将原始员工数据按年龄段和部门进行汇总，生成宽表结构**  
    输出字段包括：`dept_id`, `age_group`, `employee_count`, `avg_salary`

11. **将员工表中的日期字段转换为季度，并统计每季度入职人数**

12. **将工资字段标准化为 Z 分数，并筛选出 Z 分数 > 2 的员工**

---

### **模块五：性能优化与资源控制**

13. **使用 `EXPLAIN` 分析一个包含 JOIN 和 GROUP BY 的复杂查询的执行计划**

14. **使用 `MAPJOIN` 优化小表与大表的连接**

15. **使用 `DISTRIBUTE BY` 和 `SORT BY` 优化大表的排序操作**

---

### **模块六：数据建模与分区策略设计**

16. **设计一个员工表，按部门和年份分区，按年龄桶分，支持高效查询**

17. **模拟一个数据仓库场景，设计三个表：员工表、部门表、工资历史表，并写出一个查询：统计每个部门过去一年工资增长率**

18. **使用 `UNION ALL` 合并多个年度员工表，并统计总人数和平均工资**

---

如果你希望我为这些高级题目提供 **参考答案与解析**，我可以继续为你逐题编写。你想我现在开始吗？还是你对某个模块特别感兴趣，想先看那部分的答案？